<!DOCTYPE html>
<html lang="zh-Hans">

<!-- Head tag -->
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="è¿‘æœŸå·¥ä½œä¸­è°ƒæ•´äº†æœç´¢å¾—åˆ†ç­–ç•¥ï¼Œè€ƒè™‘å½±å“é¢æ¯”è¾ƒå¹¿ï¼ŒåŸå·¥ç¨‹é‡Œå¹¶æ²¡æœ‰A/Bæµ‹è¯•ï¼Œå› æ­¤å®Œæ•´å®ç°äº†A/Bæµ‹è¯•éƒ¨åˆ†ä»£ç ï¼Œåœ¨æ­¤è®°å½•å¿ƒå¾—ã€‚">
    

    <!--Author-->
    
        <meta name="author" content="ringo">
    

    <!-- Title -->
    
    <title>æœç´¢ç­–ç•¥çš„ A/B æµ‹è¯• | æ—æˆˆçš„å°é…’é¦†ã€‚</title>

    <!-- Bootstrap Core CSS -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]--><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body  background-color:rgb(255,241,229);>

    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Content -->
    <section class="article-container">
<!-- Back Home -->
<a class="nav-back" href="/">
    <i class="fa fa-puzzle-piece"></i>
</a>

<!-- Page Header -->
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>æœç´¢ç­–ç•¥çš„ A/B æµ‹è¯•</h1>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Main Content -->
            <div class="post-content col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>Â Â Â Â Â Â Â Â è¿‘æœŸå·¥ä½œä¸­è°ƒæ•´äº†æœç´¢å¾—åˆ†ç­–ç•¥ï¼Œè€ƒè™‘å½±å“é¢æ¯”è¾ƒå¹¿ï¼ŒåŸå·¥ç¨‹é‡Œå¹¶æ²¡æœ‰A/Bæµ‹è¯•ï¼Œå› æ­¤å®Œæ•´å®ç°äº†A/Bæµ‹è¯•éƒ¨åˆ†ä»£ç ï¼Œåœ¨æ­¤è®°å½•å¿ƒå¾—ã€‚</p>
<h1>ä¸€. ä»€ä¹ˆæ˜¯A/Bæµ‹è¯•</h1>
<p>æˆ‘ä»¬ä»¥å…·ä½“ä¾‹å­å¼•å…¥ã€‚
Airbnbæ›¾ç»æ¨å‡ºäº†2ä¸ªå…³äºæ¨å¹¿äº§å“çš„æ–‡æ¡ˆï¼š</p>
<ul>
<li>æ–‡æ¡ˆä¸€ï¼šâ€œé‚€è¯·ä½ çš„å¥½å‹å¯ä»¥è·å¾—25ç¾å…ƒâ€</li>
<li>æ–‡æ¡ˆäºŒï¼šâ€œé‚€è¯·ä½ çš„å¥½å‹å°†ä½¿å¥½å‹è·å¾—25ç¾å…ƒâ€</li>
</ul>
<p>å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://oozx0w2f09-flywheel.netdna-ssl.com/wp-content/uploads/2016/06/airbnb-referral-ab-test-e1466712507511.png" alt=""></p>
<p>Â Â Â Â Â Â Â Â å“ªç§æ–‡æ¡ˆæ›´å¥½å‘¢ï¼Ÿæˆ‘çš„ç›´è§‰æ˜¯æ–‡æ¡ˆä¸€ï¼Œä½†æ²¡æœ‰æ•°æ®æ”¯æ’‘å¾ˆéš¾ä¸‹ç»“è®ºã€‚ä¸€ä¸ªå¯¹ç­–æ˜¯ï¼šå°†è¿™2ä¸ªæ–‡æ¡ˆåŒæ—¶å‘å¸ƒåˆ°çº¿ä¸Šï¼Œå„ä¸ºå…¶åˆ†é…50%æµé‡ï¼Œè§‚å¯ŸäºŒè€…ç‚¹å‡»ç‡çš„å·®å¼‚ã€‚äº‹å®ä¸Šåæ¥ç»“æœä»¤äººåƒæƒŠï¼Œæ–‡æ¡ˆäºŒæ•ˆæœå¥½äºæ–‡æ¡ˆä¸€ã€‚</p>
<p>Â Â Â Â Â Â Â Â ä»¥ä¸Šæƒ³æ³•å°±æ˜¯A/Bæµ‹è¯•çš„åŸºæœ¬æ€æƒ³ã€‚ç®€å•æ¥è¯´å°±æ˜¯<strong>æŠŠæ€»æµé‡åˆ†ä¸ºAå’ŒBä¸¤ä»½ï¼Œéƒ¨åˆ†ç”¨äºæ—§æ–¹æ¡ˆï¼Œéƒ¨åˆ†ç”¨äºæ–°æ–¹æ¡ˆï¼Œä¸Šçº¿ä¸€æ®µæ—¶å€™åå¯¹æ¯”äºŒè€…å„é¡¹æŒ‡æ ‡ï¼ˆç‚¹å‡»ç‡ã€è½¬åŒ–ç‡ï¼‰ï¼Œä»è€Œè¡¡é‡æ–°ç­–ç•¥çš„ä¼˜åŠ£</strong>ã€‚A/Bæµ‹è¯•æ˜¯ä¸€ç§æ¨ªè·¨å‰ç«¯/åå°/ç®—æ³•çš„äº§å“ä¼˜åŒ–æ€æƒ³ï¼Œä¾‹å¦‚UIå±‚é¢ä¸Šçš„å¹¿å‘Šä½ç½®åœ¨å±å¹•ä¸­çš„åç§»é‡å¯¹ç‚¹å‡»æµé‡çš„å½±å“ï¼ˆGoogleï¼‰ï¼Œåˆæˆ–æ–°æœç´¢/æ¨èç­–ç•¥çš„æå‡ºï¼Œæœ€ç»ˆæ•ˆæœå‡éœ€è¦çº¿ä¸ŠA/Bæµ‹è¯•éªŒè¯ã€‚</p>
<h1>äºŒ. ç®—æ³•ç­–ç•¥ç±»çš„A/Bæµ‹è¯•</h1>
<h2>ç®—æ³•ç­–ç•¥ç±»çš„ä¼˜åŒ–æ­¥éª¤</h2>
<p>æœç´¢/æŒ–æ˜/æ¨èä¸‰è€…çš„ä¼˜åŒ–æ­¥éª¤å¾ˆç›¸ä¼¼ï¼Œä¸€èˆ¬æµç¨‹æ˜¯ï¼š</p>
<ul>
<li>æ¨¡å‹è®­ç»ƒ/ç­–ç•¥ä¼˜åŒ–ï¼Œå¹¶è‡ªè¡Œç¡®è®¤æ•ˆæœ</li>
<li>äº¤ç»™PMè¯„ä¼°å‡ ç»„ï¼ˆ100-1000æ¡ï¼Œè§†å½±å“é¢æƒ…å†µè€Œå®šï¼‰æ•°æ®</li>
<li>ä¿®å¤ã€ä¼˜åŒ–PMè¯„ä¼°è¿‡ç¨‹ä¸­å‘ç°çš„é—®é¢˜</li>
<li>ç”±PMç¡®è®¤æ–°æ¨¡å‹/ç­–ç•¥åœ¨æ•ˆæœä¸Šç¡®å®æœ‰æå‡</li>
<li>çº¿ä¸Šå°æµé‡A/Bæµ‹è¯•</li>
<li>çº¿ä¸Šæµé‡å¯¹æ¯”æœ‰æå‡ï¼Œè€ƒè™‘å…¨é‡ä¸Šçº¿</li>
</ul>
<h2>æœç´¢ç­–ç•¥æ¶æ„ç®€ä»‹</h2>
<p>Â Â Â Â Â Â Â Â ç®€å•çš„æœç´¢ç®—æ³•ä¸»è¦åˆ†ä¸º3éƒ¨åˆ†ï¼š<code>å€’æ’ç´¢å¼•</code>ï¼ˆç¦»çº¿ï¼‰å’Œ<code>keywordæœç´¢</code>ï¼ˆå®æ—¶ï¼‰ï¼Œå’Œ<code>å®æ—¶æ›´æ–°ç´¢å¼•</code>ã€‚å› <code>keywordæœç´¢</code>éƒ¨åˆ†ç”¨æˆ·æ„ŸçŸ¥æœ€å¼ºçƒˆã€å½±å“é¢æœ€å¹¿ï¼Œå› æ­¤å¤§éƒ¨åˆ†A/Bæµ‹è¯•éƒ½è®¾ç½®åœ¨è¿™ä¸€é˜¶æ®µã€‚
<code>keywordæœç´¢</code>é˜¶æ®µæ€»ä½“åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>ç”¨æˆ·queryåˆ†æ</li>
<li>æŒ‰ç…§queryä¸­çš„æ¡ä»¶ï¼Œæ„å»ºè¿‡æ»¤ï¼ˆFilterï¼‰/æŸ¥è¯¢(Query)æ¡ä»¶</li>
<li>æŸ¥è¯¢å¾—åˆ°å¬å›é›†(Recall Set)</li>
<li>å¯¹ç»“æœé›†è¿›è¡Œæ‰“åˆ†(Score)ã€æ’åº(Rank)</li>
</ul>
<p>æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://sfault-image.b0.upaiyun.com/200/831/2008316443-59b35fd86b894_articlex" alt="clipboard.png"></p>
<p>æ–‡å­—è§£é‡Šä¸ºï¼š</p>
<ul>
<li>é¦–å…ˆå¯¹ç”¨æˆ·queryè¿›è¡Œåˆ†æï¼Œè·å–å…¶<strong>å¯ç”¨<code>Filter</code>åšè¿‡æ»¤çš„term</strong>å’Œ<strong>åªèƒ½é€šè¿‡æŸ¥è¯¢<code>Query</code>å¾—åˆ°çš„term</strong>ï¼ŒåŸå› å¾ˆç®€å•ï¼ŒæŸ¥è¯¢æ¯”è¿‡æ»¤æ…¢å¤šäº†</li>
<li>ä»ç´¢å¼•é‡ŒæŸ¥è¯¢ã€è¿‡æ»¤å¾—åˆ°ç»“æœå€™é€‰é›†Recall Set</li>
<li>å¯¹ç»“æœè¿›è¡Œç›¸ä¼¼åº¦æ‰“åˆ†ã€æ’åº</li>
<li>å¬å›æœ€ç»ˆç»“æœ</li>
</ul>
<p>å…³äºç¬¬ä¸€æ­¥ï¼Œå®é™…sampleå¦‚ä¸‹ï¼š</p>
<p><img src="https://sfault-image.b0.upaiyun.com/221/020/2210206743-59b35e53cfcfa_articlex" alt="sample.png"></p>
<p>æ³¨æ„åˆ°<code>industry</code>å’Œ<code>city</code>å­—æ®µå¯ä»¥é€šè¿‡<code>Filter</code>è¿‡æ»¤ä»¥æé«˜æ£€ç´¢é€Ÿåº¦ã€‚</p>
<h2>A/Bæµ‹è¯•å®é™…å¼€å‘</h2>
<h3>è®¾è®¡æ€æƒ³</h3>
<p>Â Â Â Â Â Â Â Â åœ¨è®¾è®¡ä¹‹åˆæˆ‘ä»¬å°±åº”è¯¥æ˜ç¡®ï¼šåˆ°åº•å“ªäº›ç¯èŠ‚å¯ä»¥åšA/Bæµ‹è¯•å‘¢ï¼Ÿ</p>
<p>Â Â Â Â Â Â Â Â ç­”æ¡ˆæ˜¯ï¼š<strong>å…¨éƒ¨ã€‚</strong></p>
<p>Â Â Â Â Â Â Â Â æ•´ä¸ª<code>keywordæœç´¢</code>è¿‡ç¨‹ä¸­ï¼ŒQueryåˆ†æã€Queryè¿‡æ»¤å’ŒæŸ¥è¯¢ã€ç»“æœé›†å¬å›ã€ç»“æœé›†æ‰“åˆ†ã€æ’åºè¿‡ç¨‹å‡å¯ä»¥è®¾ç½®A/Bæµ‹è¯•ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¸€æ¬¡åªéœ€è¦åœ¨æŸä¸€ä¸ªç¯èŠ‚åšA/Bæµ‹è¯•ï¼Œæ­¤æ—¶å¯ä»¥å°†å…¶ä»–ç¯èŠ‚çš„ç­–ç•¥ç½®ä¸ºç›¸åŒç­–ç•¥ã€‚ä½†<strong>ä»è®¾è®¡æ€æƒ³ä¸Šï¼Œç¼–å†™ä¼Šå§‹å°±é’ˆå¯¹æ‰€æœ‰ç¯èŠ‚é…ç½®A/Bæµ‹è¯•æ˜¯å€¼å¾—æ¨èçš„ã€‚</strong></p>
<h3>ä»£ç ç¼–å†™</h3>
<h4>1. åŸå§‹ç­–ç•¥ç±»çš„ç¼–å†™</h4>
<p>é¦–å…ˆé’ˆå¯¹æ‰€æœ‰ç¯èŠ‚ç¼–å†™ä¸€ä¸ª<code>Strategy</code>æ¥å£ï¼Œ
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ISearchStrategy</span> </span>&#123;</div><div class="line">    # queryè§£æï¼Œæ„å»ºæœç´¢æ¡ä»¶</div><div class="line">    <span class="function"><span class="keyword">public</span> ISearchConditionParser <span class="title">getSearchConditionParser</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line">    # æ‰“åˆ†</div><div class="line">    <span class="function"><span class="keyword">public</span> SortDocsScorer <span class="title">getSortDocsScorer</span><span class="params">(SearchCondition searchCondition)</span></span>;</div><div class="line">    </div><div class="line">    # æ’åº</div><div class="line">    <span class="function"><span class="keyword">public</span> ISortDocsSorter <span class="title">getSortDocsSorter</span><span class="params">(SearchCondition searchCondition)</span></span>;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStrategyName</span><span class="params">(String strategyName)</span></span>;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStrategyName</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Â Â Â Â Â Â Â Â ä¸ºä½•ä»¥ä¸Šæ¥å£æ²¡æœ‰æŸ¥è¯¢ã€è¿‡æ»¤ç¯èŠ‚çš„æ–¹æ³•å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæ‰€æœ‰ç­–ç•¥çš„æŸ¥è¯¢å’Œè¿‡æ»¤è¿‡ç¨‹å‡ç›¸åŒï¼Œä¸åŒçš„æ˜¯queryè§£æè¿‡ç¨‹ä¸­å°è£…çš„filter/queryå‚æ•°ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦æ·»åŠ è¯¥æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥ä¸åŒç­–ç•¥çš„å®ç°ï¼š</p>
<p>Â Â Â Â Â Â Â Â ä¾‹å¦‚æˆ‘ä»¬æœ¬æ¬¡åªæ˜¯å¯¹<code>ç»“æœé›†æ‰“åˆ†</code>ç¯èŠ‚åšA/Bæµ‹è¯•ï¼Œé‚£ä¹ˆç¼–å†™2ä¸ªç±»ï¼š<code>DefaultSearchStrategy</code>å’Œ<code>NewScoreStrategy</code>,å…ˆæ¥çœ‹<code>DefaultSearchStrategy</code>:
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultSearchStrategy</span> <span class="keyword">implements</span> <span class="title">ISearchStrategy</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> String strategyName;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DefaultSearchStrategy</span><span class="params">()</span> </span>&#123;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> ISearchConditionParser <span class="title">getSearchConditionParser</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> DefaultSearchConditionParser();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> SortDocsScorer <span class="title">getSortDocsScorer</span><span class="params">(SearchCondition searchCondition)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (searchCondition != <span class="keyword">null</span>) &#123;</div><div class="line">			DefaultDocSimScorer simScorer = <span class="keyword">new</span> DefaultDocSimScorer(searchCondition);</div><div class="line">			pass</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> ISortDocsSorter <span class="title">getSortDocsSorter</span><span class="params">(SearchCondition searchCondition)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (searchCondition != <span class="keyword">null</span>) &#123;</div><div class="line">			pass</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStrategyName</span><span class="params">(String strategyName)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.strategyName = strategyName;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStrategyName</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> strategyName;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>NewScoreStrategy</code>å’Œä»¥ä¸ŠåŒºåˆ«åœ¨äºæ‰“åˆ†ç¯èŠ‚ï¼š
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> SortDocsScorer <span class="title">getSortDocsScorer</span><span class="params">(SearchCondition searchCondition)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (searchCondition != <span class="keyword">null</span>) &#123;</div><div class="line">        NewSimScorer simScorer = <span class="keyword">new</span> NewSimScorer(searchCondition);</div><div class="line">        pass</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4>2. ç­–ç•¥çš„ä½¿ç”¨</h4>
<p>Â Â Â Â Â Â Â Â ç°åœ¨ç­–ç•¥å·²ç»å†™å¥½äº†ï¼Œæ€ä¹ˆåœ¨å®é™…çš„æœç´¢è¿‡ç¨‹ä¸­å†³å®šè°ƒç”¨å“ªä¸€ä¸ªå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬ä¸€ä¸ªç±»<code>ABStrategyContext</code>ç”¨äºåˆå§‹åŒ–æ–°æ—§ç­–ç•¥å¹¶ä¸ºäºŒè€…å‘½åï¼š
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ABStrategyContext</span> </span>&#123;</div><div class="line">	<span class="comment">/** æ—§ç­–ç•¥ */</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ISearchStrategy oldStrategy;</div><div class="line">	<span class="comment">/** æ–°ç­–ç•¥ */</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ISearchStrategy newStrategy;</div><div class="line">	</div><div class="line">	<span class="keyword">static</span> &#123;</div><div class="line">		<span class="comment">/** ç­–ç•¥åˆå§‹åŒ– */</span></div><div class="line">		oldStrategy = <span class="keyword">new</span> DefaultSearchStrategy();</div><div class="line">		oldStrategy.setStrategyName(<span class="string">"defaultStrategy"</span>);</div><div class="line">		</div><div class="line">		newStrategy = <span class="keyword">new</span> NewScoreStrategy ();</div><div class="line">		newStrategy.setStrategyName(<span class="string">"newScoreStrategy "</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Â Â Â Â Â Â Â Â ç„¶åæ„å»ºå·¥å‚å‘æ¶ˆè´¹è€…ç¨³å®šæä¾›è¿™2ç§ç­–ç•¥ã€‚é’ˆå¯¹æ¯ä¸ªç”¨æˆ·idï¼Œæˆ‘ä»¬ä¸ºå…¶åˆ†é…æ–°æ—§ç­–ç•¥ä¸­çš„æŸä¸€ä¸ªã€‚
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchStrategyFactory</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="title">SearchStrategyFactory</span><span class="params">()</span> </span>&#123;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">    <span class="comment">/** åŒé‡æ£€éªŒé” */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SearchStrategyFactory <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">synchronized</span> (SearchStrategyFactory.class) &#123;</div><div class="line">				<span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</div><div class="line">					instance = <span class="keyword">new</span> SearchStrategyFactory();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> instance;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> ISearchStrategy <span class="title">buildSearchStrategy</span><span class="params">(UserIdentify uid)</span> </span>&#123;		</div><div class="line">		<span class="comment">/** ç”¨æˆ·è¢«åˆ†é…èµ°æ–°ç­–ç•¥ */</span></div><div class="line">		<span class="keyword">if</span> (shouldUseNewStrategy(uid)) &#123;</div><div class="line">			<span class="keyword">return</span> ABStrategyContext.newStrategy;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="comment">/** ç”¨æˆ·è¢«åˆ†é…èµ°æ—§ç­–ç•¥ */</span></div><div class="line">		<span class="keyword">return</span> ABStrategyContext.oldStrategy;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Â Â Â Â Â Â Â Â ä¸Šè¿°ä»£ç æè¿°äº†é’ˆå¯¹ä¸åŒç”¨æˆ·idåˆ†é…æ–°æ—§ç­–ç•¥çš„æ–¹å¼ï¼Œè¯¥å·¥å‚çš„æ¨¡å¼ä½¿ç”¨äº†<a href="https://github.com/fancoo/LearnJava/blob/master/%E5%B7%A5%E5%8E%82/SingletonDemo.java#L42" target="_blank" rel="external">åŒé‡æ£€éªŒé”(double checked)</a>,èƒ½ä¿è¯è¯¥å·¥å‚åªåˆ›å»ºä¸€æ¬¡ä¸”è¢«æ‰€æœ‰çº¿ç¨‹é«˜æ•ˆå…±äº«ã€‚</p>
<p>é’ˆå¯¹æŸä¸ªç”¨æˆ·ï¼Œç­–ç•¥åˆ†é…æ–¹æ³•è¢«è°ƒç”¨å¤„ä»£ç ä¸ºï¼š
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ISearchStrategy strategy = SearchStrategyFactory.getInstance()</div><div class="line">		.buildSearchStrategy(criteria.getUserIdentify());</div><div class="line"><span class="comment">/** æ‹¿åˆ°strategyåï¼Œä¸ºå„ä¸ªç¯èŠ‚å¡«å……å…·ä½“ç­–ç•¥ */</span></div><div class="line">ISearchConditionParser parser = strategy.getSearchConditionParser();</div><div class="line">SortDocsScorer scorer = strategy.getSortDocsScorer(searchCondition);</div><div class="line">ISortDocsSorter sorter = strategy.getSortDocsSorter(searchCondition);</div></pre></td></tr></table></figure></p>
<p>Â Â Â Â Â Â Â Â æ³¨æ„åˆ°<code>SearchStrategyFactory</code>ä¸­ä¸­æœ‰ä¸€ä¸ªåˆ¤æ–­<code>shouldUseNewStrategy(uid)</code>æ–¹æ³•æ²¡æœ‰å®ç°ï¼Œé‚£ä¹ˆç°åœ¨é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬å¦‚ä½•å†³å®šæŸä¸ªç”¨æˆ·è¯¥èµ°å“ªç§ç­–ç•¥å‘¢ï¼Ÿ</p>
<h4>3. ç”¨æˆ·åˆ†æ¡¶</h4>
<p>A/Bæµ‹è¯•çš„å‡ ä¸ªè¦ç‚¹:</p>
<ul>
<li>åŒä¸€ç”¨æˆ·åœ¨ä»»æ„æ—¶é—´ï¼Œçœ‹åˆ°çš„åº”è¯¥æ˜¯åŒä¸€ç­–ç•¥</li>
<li>ç¡®ä¿Aå’ŒBæ ·æœ¬åˆ†å¸ƒä¸æ€»ä½“åˆ†å¸ƒç›¸ä¼¼</li>
<li>ç½®ä¿¡åº¦ä¿è¯ã€‚å¦‚æœæ€»ä½“æµé‡å°±ä¸å¤§ï¼Œå¯¹æ–°ç­–ç•¥åˆ†é…çš„æµé‡ä¸ºæ€»æµé‡çš„1%ï¼Œå®é™…å¯¹æ¯”åå³ä½¿æ•ˆæœæœ‰æå‡ï¼Œä¹Ÿå¾ˆéš¾æ–­å®šæ–°ç­–ç•¥æ›´ä¼˜</li>
</ul>
<p>Â Â Â Â Â Â Â Â é’ˆå¯¹ç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªå¾ˆå¤§çš„<strong>ç¼“å­˜æ± </strong>ï¼Œå°†äº§ç”Ÿæœç´¢åŠ¨ä½œçš„ç”¨æˆ·idå¯¹åº”ç­–ç•¥åˆ†é…æ–¹æ¡ˆè®°å½•ä¸‹æ¥ã€‚é’ˆå¯¹ç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬éœ€è¦<strong>ä½¿åˆ†é…è¿‡ç¨‹å°½é‡éšæœº</strong>ï¼Œé’ˆå¯¹ç¬¬ä¸‰ç‚¹ï¼Œæ–°ç­–ç•¥<strong>æµé‡å¯ä»¥é€‚å½“è®¾ç½®å¤§ä¸€äº›</strong>ã€‚</p>
<p>åˆ†æ¡¶ä»£ç å¦‚ä¸‹ï¼š
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** åˆ©ç”¨LRUç­–ç•¥ç¼“å­˜å·²ç»è®¡ç®—è¿‡çš„hashå€¼ */</span></div><div class="line"><span class="keyword">private</span> LRUCache&lt;String, Long&gt; cache = <span class="keyword">new</span> LRUCache&lt;&gt;(<span class="number">500000</span>);</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> SearchStrategyFactory instance;</div><div class="line"><span class="comment">/** æ€»æµé‡æƒé‡ */</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> WEIGHT = <span class="number">100</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">shouldUseNewStrategy</span><span class="params">(UserIdentify uid)</span> </span>&#123;</div><div class="line">		hashValue = getRandom(getHashValue(userIdentify.getUserId()));</div><div class="line">		</div><div class="line">		<span class="comment">/** æ ¹æ®æ–°ç­–ç•¥æµé‡å ç™¾åˆ†æ¯”[0-100]å†³å®šç”¨æˆ·åˆ†é…æ¦‚ç‡ */</span></div><div class="line">		<span class="keyword">if</span> (hashValue * WEIGHT &lt; DynamicConfig.NEW_STRATEGY_FLOW) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * ä»cacheè·å–hashå€¼ï¼Œä¸å­˜åœ¨åˆ™è®¡ç®—hashå€¼å¹¶å­˜å…¥cache</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span></span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">getHashValue</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">	Long hash = cache.get(key);</div><div class="line">	<span class="keyword">if</span> (hash == <span class="keyword">null</span>) &#123;</div><div class="line">		hash = SimpleHashFunction.DJBHash(key);</div><div class="line">		cache.put(key, hash);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> hash;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * æ ¹æ®seedè¿”å›[0,1]ä¹‹é—´çš„éšæœºæ•°</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> seed</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span></span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">getRandom</span><span class="params">(<span class="keyword">long</span> seed)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> Random(seed).nextDouble();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2>ä¸‰. åç»­åŠæ€»ç»“</h2>
<p>æˆ‘ä»¬æ­¤å¤„ä»…å¯¹ç­–ç•¥è¿›è¡Œäº†A/Bæµ‹è¯•ï¼Œè¦é…åˆæ•°æ®å¹³å°æ—¥å¿—åˆ†æå¯¹æ¯”å·¥ä½œï¼Œè¿˜éœ€è¦åœ¨ç”¨æˆ·æœç´¢æ—¥å¿—ä¸­å¢åŠ <code>strategyName</code>å­—æ®µæ¥ä½œæ–°æ—§ç­–ç•¥åŒºåˆ†ã€‚</p>
<p>æœ€åä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä»€ä¹ˆæ ·çš„æ–¹æ¡ˆä¸é€‚åˆA/Bæµ‹è¯•ï¼Ÿä»¥ä¸‹æ˜¯æˆ‘çš„ä¸ªäººç†è§£ã€‚</p>
<ul>
<li><strong>ä¸¤ä¸ªç‰ˆæœ¬å˜é‡å·®å¼‚è¿‡å¤§</strong>ã€‚ä¾‹å¦‚å¤šä¸ªæ–°ç­–ç•¥æ··åˆåœ¨ä¸€èµ·ä¸åŸå§‹ç­–ç•¥åšA/Bæµ‹è¯•ï¼Œå°½ç®¡æˆ‘ä»¬èƒ½å¯¹æ¯”æ–°ç­–ç•¥ç»„åˆæ˜¯â€œå˜å¥½äº†â€è¿˜æ˜¯â€œå˜å·®äº†â€ï¼Œä½†æ— æ³•é¢„çŸ¥å…·ä½“æ˜¯å“ªä¸ªæ–°ç­–ç•¥äº§ç”Ÿçš„å¢ç›Šï¼Œåç»­ä¸€æ—¦åšç­–ç•¥ä¼˜åŒ–åˆ™ä¸çŸ¥ä»ä½•åšèµ·ã€‚</li>
<li><strong>åŠŸèƒ½æ€§æ–¹æ¡ˆ</strong>ã€‚ä¾‹å¦‚ç°åœ¨æ–°å¢â€œé«˜çº§æœç´¢â€éœ€æ±‚ï¼Œé¡¹ç›®å®Œæˆåæˆ‘ä»¬æ˜¯ä¸éœ€è¦å¯¹æœ‰â€œé«˜çº§æœç´¢â€å’Œæ²¡æœ‰â€œé«˜çº§æœç´¢â€åšA/Bæµ‹è¯•çš„ï¼ŒåŸå› æ˜¯å®ƒæ˜¯åŠŸèƒ½æ€§æ–¹æ¡ˆã€‚è¯„ä¼°â€œé«˜çº§æœç´¢â€æ˜¯å¦æœ‰ä»·å€¼ï¼Œåç»­å¯¹â€œé«˜çº§æœç´¢â€æµé‡åˆ†æå’Œè°ƒç ”ç”¨æˆ·åé¦ˆå³å¯ï¼Œè¿™å¹¶ä¸æ˜¯A/Bæµ‹è¯•çš„èŒƒç•´ã€‚</li>
</ul>
<p>æ—æˆˆ  |  myfancoo@gmail.com</p>

 
                <!-- Meta -->
                <div class="post-meta">
                    <hr>
                    <br>
                    <div class="post-tags">
                        
                            

<a href="/tags/æœç´¢å¼•æ“/">#æœç´¢å¼•æ“</a> <a href="/tags/æµ‹è¯•/">#æµ‹è¯•</a>


                        
                    </div>
                    <div class="post-date">
                        2017 å¹´ 09 æœˆ 09 æ—¥
                    </div>
                </div>
            </div>

            <!-- Comments -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- Disqus Comments -->


            </div>
        </div>
    </div>
</article>
</section>

    <!-- Scripts -->
    <!-- jQuery -->
<script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script type="text/javascript">
	console.log('Hexo-theme-hollow designed by zchen9 ğŸ™‹ Â© 2015-' + (new Date()).getFullYear());
</script>

    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-98699464-1', 'auto');
        ga('send', 'pageview');

    </script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>

</html>